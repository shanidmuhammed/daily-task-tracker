<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Task Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <div class="container">
    <h2>Daily Task Tracker</h2>
    <form id="taskForm" class="d-flex gap-2 mb-4">
      <input type="text" id="taskInput" class="form-control" placeholder="Enter new task" autocomplete="off" required />
      <button type="submit" class="btn btn-primary">Add</button>
    </form>
    <h5>Active Tasks
      <button id="completeAllBtn" class="complete-all-btn" title="Mark All as Completed">Mark All</button>
    </h5>
    <ul class="list-group" id="activeList"></ul>
    <h5>
      Completed Tasks
      <button id="clearCompletedBtn" class="clear-btn">Clear Completed</button>
    </h5>
    <ul class="list-group" id="completedList"></ul>
  </div>
  <script>
    const activeList = document.getElementById('activeList');
    const completedList = document.getElementById('completedList');
    const taskForm = document.getElementById('taskForm');
    const taskInput = document.getElementById('taskInput');
    const clearCompletedBtn = document.getElementById('clearCompletedBtn');
    const completeAllBtn = document.getElementById('completeAllBtn');

    function createTaskElement(task) {
  const li = document.createElement('li');
  li.className = 'list-group-item d-flex justify-content-between align-items-center';

  // Custom toggle button (like old script)
  const btnToggle = document.createElement('button');
  btnToggle.className = 'btn-toggle' + (task.completed ? ' selected' : '');
  btnToggle.title = task.completed ? 'Undo' : 'Mark Completed';

  const radioCircle = document.createElement('span');
  radioCircle.className = 'radio-circle';
  const radioDot = document.createElement('span');
  radioDot.className = 'radio-dot';
  radioCircle.appendChild(radioDot);
  btnToggle.appendChild(radioCircle);

  btnToggle.addEventListener('click', async () => {
    await fetch(`/tasks/${task.id}`, {
      method: 'PUT',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({completed: !task.completed})
    });
    refreshTasks();
  });

  const label = document.createElement('p');
  label.className = 'task-label' + (task.completed ? ' task-completed' : '');
  label.textContent = task.task;
  label.style.flexGrow = '1';
  label.style.cursor = 'pointer';

  const btnDelete = document.createElement('button');
  btnDelete.textContent = 'Ã—';
  btnDelete.className = 'btn-delete';
  btnDelete.title = 'Delete Task';
  btnDelete.addEventListener('click', async () => {
    await fetch(`/tasks/${task.id}`, {method: 'DELETE'});
    refreshTasks();
  });

  li.appendChild(btnToggle);
  li.appendChild(label);
  li.appendChild(btnDelete);

  return li;
}

    async function refreshTasks() {
      const response = await fetch('/tasks');
      const tasks = await response.json();
      activeList.innerHTML = '';
      completedList.innerHTML = '';
      tasks.forEach(task => {
        const taskEl = createTaskElement(task);
        if(task.completed) completedList.appendChild(taskEl);
        else activeList.appendChild(taskEl);
      });
    }

    taskForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const taskText = taskInput.value.trim();
      if(!taskText) return;

      await fetch('/tasks', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({task: taskText})
      });

      taskInput.value = '';
      refreshTasks();
    });

    clearCompletedBtn.addEventListener('click', async () => {
      const response = await fetch('/tasks');
      const tasks = await response.json();
      for(const task of tasks) {
        if(task.completed) {
          await fetch(`/tasks/${task.id}`, {method: 'DELETE'});
        }
      }
      refreshTasks();
    });

    // Load tasks on page load
    refreshTasks();
  </script>
</body>
</html>
